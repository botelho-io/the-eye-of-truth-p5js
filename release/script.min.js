const t="./pde/data/",e={X:t=>[color(10,35,66),color(255,219,112),color(239,118,123),color(163,109,143),color(247,240,234)][round(t)],L:t=>[color(77,95,117),color(255,228,151),color(244,155,159),color(188,148,174),color(248,243,239)][round(t)],Y:t=>[color(8,26,50),color(186,160,83),color(175,86,90),color(119,81,106),color(179,174,170)][round(t)]};function o(t,e,o){this.p,this.r,this.rr,this.C=(t=>{t.ellipse(p.x,p.y,2*r,2*r)}),this.setRadius=(t=>{r=t,rr=t*t}),this.p=createVector(t,e),this.r=o,this.rr=o*o}function i(t,e){this.value,this.x,this.y,i.prototype.C=(t=>{value<1?t.set(x,y,color(255,0,0)):t.set(x,y,color(0,255,0)),t.text(value,x+1,y+1)}),this.x=t,this.y=e}function s(){this.D,this.grid,this.origins,this.displaced,this.m=createVector(0,0),this.U,this.foreground,s.prototype.randomBg=(()=>{let t=round(random(0,4)),o=round(random(0,3));U=e.X(t),o>=t&&o++,foreground=e.X(o)}),s.prototype.C=(()=>{this.m=p5.Vector.lerp(this.m,createVector(mouseX,mouseY),.5);let e,o,i=createVector(1*(this.m.x-0),1*(this.m.y-0));for(let s=0;s<20;s++)e=this.origins[s],(o=p5.Vector.dist(e,i))<t?this.displaced[s].set(p5.Vector.add(e,p5.Vector.sub(e,i).mult((1-o/t)*r))):this.displaced[s].set(e.x,e.y);this.grid.clacVals(),this.D.clear(),this.D.noStroke(),this.D.fill(foreground),this.grid.lerpRaster(),background(U),image(this.D,0,0,width-0,height-0)}),this.D=createGraphics(floor(1*(width-0)),floor(1*(height-0)),P2D),this.grid=new function t(e,s,r,h){this.A,this.balls,this.B;const a=[[],[7,4,0],[5,1,4],[7,5,1,0],[6,2,5],[6,2,5,4,0,7],[6,2,1,4],[6,2,1,0,7],[3,6,7],[3,6,4,0],[3,6,5,1,4,7],[3,6,5,1,0],[3,2,5,7],[3,2,5,4,0],[3,2,1,4,7],[3,2,1,0]];t.prototype.randomBalls=((t,e,i)=>{this.balls=new Array(t);for(let s=0;s<t;s++)this.balls[s]=new o(random(.1*this.B.width,.9*this.B.width),random(.1*this.B.height,.9*this.B.height),random(e,i))}),t.prototype.CDots=(()=>{this.B.fill(color(125)),this.B.textSize(8);for(let t of this.A)for(let e of t)e.C(B)}),t.prototype.CBalls=(()=>{this.B.stroke(color(0,255,0)),this.B.noFill();for(let t of this.balls)t.C(B)}),t.prototype.clacVals=(()=>{let t,e;for(let o of this.A)for(dot of o){dot.value=0;for(let o of this.balls)t=dot.x-o.p.x,e=dot.y-o.p.y,dot.value+=o.rr/(t*t+e*e)}}),t.prototype.simpleRaster=(()=>{for(let t=0;t<this.A.length-1;t++)for(let e=0;e<d-1;e++)this.A[t][e].value>=1&&this.A[t+1][e].value>=1&&this.A[t][e+1].value>=1&&this.A[t+1][e+1].value>=1&&this.B.rect(A[t][e].x,A[t][e].y,l,n)}),t.prototype.marchingSquaresRaster=(()=>{for(let t=0;t<this.A.length-1;t++)for(let e=0;e<d-1;e++){let o=0;this.A[t][e].value>=1&&(o+=8),this.A[t+1][e].value>=1&&(o+=4),this.A[t][e+1].value>=1&&(o+=1),this.A[t+1][e+1].value>=1&&(o+=2),this.B.beginShape();for(let i of a[o])switch(i){case 0:this.B.vertex(this.A[t][e].x,this.A[t][e].y+n);break;case 1:this.B.vertex(this.A[t][e].x+l,this.A[t][e].y+n);break;case 2:this.B.vertex(this.A[t][e].x+l,this.A[t][e].y);break;case 3:this.B.vertex(this.A[t][e].x,this.A[t][e].y);break;case 4:this.B.vertex(this.A[t][e].x+p,this.A[t][e].y+n);break;case 5:this.B.vertex(this.A[t][e].x+l,this.A[t][e].y+c);break;case 6:this.B.vertex(this.A[t][e].x+p,this.A[t][e].y);break;case 7:this.B.vertex(this.A[t][e].x,this.A[t][e].y+c)}this.B.endShape(CLOSE)}}),t.prototype.lerpRaster=(()=>{let t;for(let e=0;e<this.A.length-1;e++)for(let o=0;o<d-1;o++){let i=0;this.A[e][o].value>=1&&(i+=8),this.A[e+1][o].value>=1&&(i+=4),this.A[e][o+1].value>=1&&(i+=1),this.A[e+1][o+1].value>=1&&(i+=2),this.B.beginShape();for(let s of a[i])switch(s){case 0:this.B.vertex(this.A[e][o].x,this.A[e][o].y+n);break;case 1:this.B.vertex(this.A[e][o].x+l,this.A[e][o].y+n);break;case 2:this.B.vertex(this.A[e][o].x+l,this.A[e][o].y);break;case 3:this.B.vertex(this.A[e][o].x,this.A[e][o].y);break;case 4:t=this.A[e][o+1].value,this.B.vertex(this.A[e][o].x+l*((1-t)/(this.A[e+1][o+1].value-t)),this.A[e][o].y+n);break;case 5:t=this.A[e+1][o].value,this.B.vertex(this.A[e][o].x+l,this.A[e][o].y+n*((1-t)/(this.A[e+1][o+1].value-t)));break;case 6:t=this.A[e][o].value,this.B.vertex(this.A[e][o].x+l*((1-t)/(this.A[e+1][o].value-t)),this.A[e][o].y);break;case 7:t=this.A[e][o].value,this.B.vertex(this.A[e][o].x,this.A[e][o].y+n*((1-t)/(this.A[e][o+1].value-t)))}this.B.endShape(CLOSE)}}),this.B=e;const d=r,l=round((this.B.width+2*h)/(s-1))+1,n=round((this.B.height+2*h)/(r-1))+1,p=round(l/2),c=round(n/2);let g=new Array(d);for(let t=0;t<d;t++)g[t]=t*n;this.A=new Array(s);for(let t=0;t<this.A.length;t++){this.A[t]=new Array(d);let e=t*l;for(let o=0;o<d;o++)this.A[t][o]=new i(e,g[o])}}(this.D,floor(.095*this.D.width),floor(.095*this.D.height),0),this.grid.randomBalls(20,.015*this.D.width,.1*this.D.width),this.origins=new Array(20),this.displaced=new Array(20);for(let t=0;t<20;t++)this.displaced[t]=this.grid.balls[t].p,this.origins[t]=this.grid.balls[t].p.copy();const t=floor(.25*floor(1*(width-0))),r=floor(.004*floor(1*(height-0)));this.randomBg()}function h(){this.ps,h.prototype.load=(()=>{h.prototype.P=[],h.prototype.E=[],h.prototype.M=[],h.prototype.P=new Array(7),h.prototype.P[0]=loadImage(t+"eye/P0.png"),h.prototype.P[1]=loadImage(t+"eye/P1.png"),h.prototype.P[2]=loadImage(t+"eye/P2.png"),h.prototype.P[3]=loadImage(t+"eye/P4.png"),h.prototype.P[4]=loadImage(t+"eye/P5.png"),h.prototype.P[5]=loadImage(t+"eye/P6.png"),h.prototype.P[6]=loadImage(t+"eye/P7.png"),h.prototype.M=new Array(7),h.prototype.E=new Array(7),h.prototype.M[0]=loadImage(t+"eye/M0.png"),h.prototype.E[0]=loadImage(t+"eye/E0.png"),h.prototype.M[1]=loadImage(t+"eye/M1.png"),h.prototype.E[1]=loadImage(t+"eye/E1.png"),h.prototype.M[2]=loadImage(t+"eye/M3.png"),h.prototype.E[2]=loadImage(t+"eye/E3.png"),h.prototype.M[3]=loadImage(t+"eye/M4.png"),h.prototype.E[3]=loadImage(t+"eye/E4.png"),h.prototype.M[4]=loadImage(t+"eye/M5.png"),h.prototype.E[4]=loadImage(t+"eye/E5.png"),h.prototype.M[5]=loadImage(t+"eye/M6.png"),h.prototype.E[5]=loadImage(t+"eye/E6.png"),h.prototype.M[6]=loadImage(t+"eye/M7.png"),h.prototype.E[6]=loadImage(t+"eye/E7.png")}),h.prototype.getGroup=function(){let t=new Array(3);return t[0]=h.prototype.P[round(random(0,h.prototype.P.length-1))],this.ps=round(random(0,h.prototype.E.length-1)),t[1]=h.prototype.E[this.ps],t[2]=h.prototype.M[this.ps],t},null==h.prototype.P&&this.load()}function a(t,e,o){this.P,this.E,this.M,this.R,this.T,this.G,this.imgCtr,this.P=t[0],this.E=t[1],this.M=t[2],this.G=createGraphics(this.E.width,this.E.height),this.imgCtr=createVector(this.E.width/2,this.E.height/2),this.R=.4*this.E.height,this.T=new function(t,e,o,i){this.position=createVector(t,e),this.size=createVector(o,i),this.C=function(){noFill(),stroke(color(255,0,0)),rect(this.position.x,this.position.y,this.size.x,this.size.y)}}(e,o,this.E.width,this.E.height),this.C=function(t){let e=t.copy();e.sub(this.T.position),e.x*=this.G.width/this.T.size.x,e.y*=this.G.height/this.T.size.y;let o=p5.Vector.dist(this.imgCtr,e);o>this.R&&(o=this.R),e.sub(this.imgCtr).normalize().mult(o).add(this.imgCtr),this.G.background(color(255,255,255)),this.G.image(this.P,e.x-this.P.width/2,e.y-this.P.height/2),this.G.image(this.E,0,0,this.G.width,this.G.height),image(this.G.mask(this.M),this.T.position.x,this.T.position.y,this.T.size.x,this.T.size.y)}}function d(){this.randomFaceAtAngle=function(t,e,o){let i=this.faces[round(random(0,this.faces.length-1))],s=this.backs[round(random(0,this.backs.length-1))],r=createGraphics(i.width,i.height,P2D),h=createGraphics(s.width,s.height,P2D);h.background(o),r.background(e),t.imageMode(CENTER),t.translate(random(0,t.width-.05*t.height),random(0,.95*t.height));let a=random(.35,.55);t.push(),t.scale(a,a),t.rotate(radians(random(0,360))),t.image(h.mask(s),0,0),t.pop();let d=p5.Vector.random2D();d.mult(.1*t.height),t.translate(d.x,d.y),random(1)>.5?t.scale(1,-1):t.scale(-1,-1),a=random(.4,.6),t.scale(a,a),t.rotate(radians(180+random(-15,15))),t.image(r.mask(i),0,0),t.reset()},d.prototype.load=(()=>{d.prototype.faces=new Array(10);for(let e=0;e<d.prototype.faces.length;e++)d.prototype.faces[e]=loadImage(t+"faces/F"+e+".png");d.prototype.backs=new Array(8);for(let e=0;e<d.prototype.backs.length;e++)d.prototype.backs[e]=loadImage(t+"faces/B"+e+".png")}),null==d.prototype.faces&&this.load()}let l,n,c,g,u,w,m,f,v,b,k,E,C,T,M,P,I,G,A;function V(t){n.__selected=n.files[t],n.files[t]=void 0}function R(){image(n.__selected,width/2,height/2)}window.preload=(()=>{l=loadSound(t+"driverEOTT.mp3"),u=new p5.FFT,g=new p5.PeakDetect(440,4700,.2,1),c={detect:function(){u.analyze(),g.update(u)},isOnset:()=>g.isDetected},(n={__selected:null,play:function(){this.__selected.play()},stop:function(){this.__selected.stop()},files:{"intro.mov":null,"fear.mov":null,"yeah.mov":null},loadAll:function(){for(var e of Object.keys(this.files))this.files[e]=createVideo(t+e),this.files[e].hide()}}).loadAll(),w=new h,m=[loadImage(t+"bigEye/P.png"),loadImage(t+"bigEye/E.png"),loadImage(t+"bigEye/M.png")],f=new d}),p5.Graphics.prototype.mask=function(t){var e=createImage(this.width,this.height);return e.copy(this,0,0,this.width,this.height,0,0,this.width,this.height),e.mask(t),e},window.setup=(()=>{fullscreen(!0),createCanvas(window.innerWidth,window.innerHeight),M=new s,P=new function t(){this.m=createVector(width/2,height/2),this.U,t.prototype.randomBg=(()=>{U=e.X(random(0,4))}),t.prototype.C=(t=>{if(background(U),this.m=p5.Vector.lerp(this.m,createVector(mouseX,mouseY),.1),t){let t=random(.4,1),e=new a(this.cache.getGroup(),floor(random(0,width)),floor(random(0,height)));e.T.size.x*=t,e.T.size.y*=t,e.T.position.x+e.T.size.x>width&&(e.T.position.x=random(0,width-e.T.size.x)),e.T.position.y+e.T.size.y>height&&(e.T.position.y=random(0,height-e.T.size.y)),this.e.push(e),this.randomBg()}for(let t of this.e)t.C(this.m)}),this.cache=new h,this.e=[],this.randomBg()},I=new a(m,width/2-m[1].width/2,height/2-m[1].height/2),m=void 0,G=new function t(){t.prototype.C=(()=>{clear(),textAlign(CENTER,CENTER),text("I SEE WHAT\nYOU MEAN",width/2,height/2)})},A=new function(){this.randomBg=(()=>{this.backColor=e.X(random(0,4))}),this.addFace=(()=>{let t=round(random(0,4)),o=round(random(0,3));this.U=e.L(t),o>=t&&o++,this.foreground=e.Y(o),this.fi.randomFaceAtAngle(this.g,this.foreground,this.U)}),this.C=(()=>{image(this.g,0,0)}),this.g=createGraphics(width,height),this.fi=new d,this.randomBg()},v=!1,b=!1,k=!1,E=!1,C=e.X(0),T=createVector(width/2,height/2),V("intro.mov")}),window.draw=(()=>{imageMode(CENTER),window.draw=(()=>{background(color(76,95,117)),R()}),function(){let t=l.addCue(24.105,()=>{l.removeCue(t),n.stop(),V("fear.mov"),imageMode(CORNER),window.draw=(()=>{c.detect(),(b=c.isOnset())&&!v&&M.randomBg(),v=b,M.C()})}),o=l.addCue(44.953,()=>{l.removeCue(o),imageMode(CENTER),n.play(),M=void 0,window.draw=(()=>{background(color(76,95,117)),R()})}),i=l.addCue(48.038,()=>{l.removeCue(i),n.stop(),V("yeah.mov"),imageMode(CORNER),window.draw=(()=>{c.detect(),b=c.isOnset(),P.C(b&&!v),v=b})}),s=l.addCue(71.222,()=>{l.removeCue(s),P=void 0,imageMode(CENTER),w=void 0,n.play(),window.draw=(()=>{background(color(76,95,117)),R()})}),r=l.addCue(71.968,()=>{l.removeCue(r),n.stop(),n=void 0,imageMode(CORNER),window.draw=(()=>{background(C),c.detect(),(b=c.isOnset())&&!v&&(C=e.X(random(0,4))),v=b,T=p5.Vector.lerp(T,createVector(mouseX,mouseY),.05),I.C(T)})}),h=l.addCue(88.407,()=>{l.removeCue(h),I=void 0,textSize(window.innerHeight/6),window.draw=(()=>{background(e.X(0)),G.C()})}),a=l.addCue(89.649,()=>{l.removeCue(a),G=void 0,window.draw=(()=>{c.detect(),(b=c.isOnset())&&!v&&A.addFace(),v=b,(E=keyIsPressed&&" "==key)&&!k&&A.randomBg(),k=E,background(A.backColor),A.C()})}),d=l.addCue(137.785,()=>{l.removeCue(d),textAlign(LEFT,BOTTOM),textSize(window.innerHeight/30),window.draw=(()=>{let t=l.currentTime();background(A.backColor),A.C();let e=(t-137.785)/(l.duration()-137.785);e=constrain(2*e,0,1);let o=color(0,0,0);o.setAlpha(floor(255*e)),fill(o),rect(0,0,width,height),(o=color(255,255,255)).setAlpha(floor(255*e)),fill(o),text("Driver | The Eye of Truth\nAndré Botelho & Luísa Lino",40,height-40)})})}(),n.play(),l.play()});